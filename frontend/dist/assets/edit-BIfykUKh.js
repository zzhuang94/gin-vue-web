import{d as I,W as J,r as D,X as M,w as P,Y as Q,e as c,o as s,k as m,b as h,g as Y,f as b,a as p,V as r,Z as W,F as x,U as $,Q as V,l as j,$ as w,t as S,a0 as X,R as C,a1 as Z,p as G}from"./index-DYOhyz3y.js";import{d as k,D as ee}from"./dayjs-xYaG-AM6.js";import{s as ae}from"./strlib-BEzNp4-y.js";import{_ as te}from"./ajax-select.vue_vue_type_script_setup_true_lang-BtayvKP4.js";import{_ as le}from"./tooltip.vue_vue_type_script_setup_true_lang-Bs5npMln.js";import{F as oe,_ as ne}from"./index-CtWRo1tg.js";import{S as ie,a as de}from"./index-BQ49TyCR.js";import{C as se}from"./index-BSiPgxx2.js";import"./colors-Bpsbp8bl.js";import"./useMergedState-BdfiktY8.js";import"./Trigger-hrLkRm_d.js";import"./useMemo-BcdUHJ78.js";import"./shallowequal-BRkqXPnN.js";import"./move-BWutTfui.js";import"./slide-CQ-VQXWP.js";import"./index-C3yRgRBs.js";import"./firstNotUndefined-CLFzEa0p.js";import"./hasIn-DVGmtqdP.js";import"./isSymbol-BvF39bG2.js";import"./Col-DGp_g86x.js";import"./responsiveObserve-ZGacTiJK.js";import"./useFlexGapSupport-C2wBInw4.js";import"./collapseMotion-Wl6vKenj.js";import"./debounce-BGQhSD8L.js";import"./Overflow-bmiPXItz.js";import"./List-CpsawxSz.js";import"./isMobile--2fOlCHx.js";import"./index-CA7H8caH.js";const re=["innerHTML"],ce=["innerHTML"],ue={key:2},qe=I({__name:"edit",props:{width:{default:"50%"},title:{},subtitle:{default:""},data:{},rules:{default:()=>[]},check:{type:Boolean,default:!1},action:{}},emits:["submit","reload"],setup(i,{emit:B}){const _=i,{data:l,rules:f}=J(_),H=B,g=D(!0),U=D(!1),u=M(F());P(u,t=>{Object.keys(t).forEach(e=>{t[e]||delete d[e]})},{deep:!0});const d=M(O()),L=async()=>{U.value=!0,await j.ajax(_.action??"",T())&&(g.value=!1,H("submit")),U.value=!1};function F(){const t={};for(const e of f.value)t[e.key]=!_.check;return t}function O(){const t={};for(const e of f.value)if(l.value&&l.value[e.key]!==void 0)if(e.split_sep&&e.textarea)t[e.key]=String(l.value[e.key]).split(e.split_sep).join(`
`);else if(e.textarea&&e.json)t[e.key]=ae.formatJson(l.value[e.key]);else if(e.split_sep&&e.limit)l.value[e.key]===""?t[e.key]=[]:t[e.key]=String(l.value[e.key]).split(e.split_sep);else if(e.date&&l.value[e.key]){const n=k(l.value[e.key]);t[e.key]=n.isValid()?n:l.value[e.key]}else if(e.datetime&&l.value[e.key]){const n=k(l.value[e.key]);t[e.key]=n.isValid()?n:l.value[e.key]}else t[e.key]=l.value[e.key];else e.split_sep&&(e.limit||e.limit_list)?t[e.key]=[]:t[e.key]=e.default||"";return t}function T(){const t={};d.id!==void 0&&(t.id=String(d.id));for(const e of f.value){const n=d[e.key];n!==void 0&&(G.isArray(n)?e.split_sep?t[e.key]=n.map(y=>String(y)).join(e.split_sep):t[e.key]=n.map(y=>String(y)):e.date&&n?t[e.key]=k(n).isValid()?k(n).format("YYYY-MM-DD"):String(n):e.datetime&&n?t[e.key]=k(n).isValid()?k(n).format("YYYY-MM-DD HH:mm:ss"):String(n):t[e.key]=String(n))}return t}return(t,e)=>{const n=W,y=ne,E=se,N=de,q=ie,R=X,v=ee,z=Q("a-date-time-picker"),K=oe,A=Z;return s(),c(A,{width:i.width,"cancel-text":"取消","ok-text":"保存",maskClosable:!1,onOk:L,open:g.value,"onUpdate:open":e[1]||(e[1]=a=>g.value=a),"confirm-loading":U.value},{title:m(()=>[h("div",{innerHTML:i.title},null,8,re),i.subtitle?(s(),p("div",{key:0,innerHTML:i.subtitle,style:{"font-size":"0.9rem",color:"navy"}},null,8,ce)):b("",!0)]),default:m(()=>[e[4]||(e[4]=h("hr",null,null,-1)),Y(K,{model:d,"label-col":{span:4},"wrapper-col":{span:19}},{default:m(()=>[r(l)?.id?(s(),c(y,{key:0,style:{display:"none"}},{default:m(()=>[Y(n,{value:d.id,"onUpdate:value":e[0]||(e[0]=a=>d.id=a),type:"hidden"},null,8,["value"])]),_:1})):b("",!0),(s(!0),p(x,null,$(r(f),a=>(s(),p(x,{key:a.key},[!i.check||!a.readonly?(s(),c(y,{key:0,required:a.required&&!i.check},{label:m(()=>[i.check?(s(),c(E,{key:0,checked:u[a.key],"onUpdate:checked":o=>u[a.key]=o},null,8,["checked","onUpdate:checked"])):b("",!0),e[3]||(e[3]=w("   ",-1)),a.describe?(s(),c(le,{key:1,placement:"left",color:"blue",icon:!1,msg:a.describe},{default:m(()=>[e[2]||(e[2]=h("i",{class:"fa fa-info-circle text-info"},null,-1)),w(" "+S(a.name),1)]),_:2},1032,["msg"])):(s(),p("span",ue,S(a.name),1))]),default:m(()=>[a.limit?(s(),c(q,{key:0,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,"show-search":"","allow-clear":"",filterOption:r(j).filterByLabel,placeholder:`请选择${a.name}`,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly,mode:a.split_sep?"multiple":"undefined"},{default:m(()=>[(s(!0),p(x,null,$(a.limit,o=>(s(),c(N,{key:o.key||o,value:o.key!==void 0?o.key:o,label:o.label||o},{default:m(()=>[w(S(o.label||o),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["value","onUpdate:value","filterOption","placeholder","disabled","mode"])):a.trans&&a.trans.ajax?(s(),c(te,{key:1,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,placeholder:`请选择${a.name}`,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly,translate:a.trans},null,8,["value","onUpdate:value","placeholder","disabled","translate"])):a.textarea?V((s(),c(R,{key:2,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,placeholder:`请输入${a.name}，支持换行`,readonly:(r(l)?.id||i.check)&&a.readonly,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly,"auto-size":{minRows:2}},null,8,["value","onUpdate:value","placeholder","readonly","disabled"])),[[C,!i.check||!a.readonly]]):a.date?(s(),c(v,{key:3,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,placeholder:`请选择${a.name}`,readonly:(r(l)?.id||i.check)&&a.readonly,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly,style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder","readonly","disabled"])):a.datetime?(s(),c(z,{key:4,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,placeholder:`请选择${a.name}`,readonly:(r(l)?.id||i.check)&&a.readonly,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly,style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder","readonly","disabled"])):V((s(),c(n,{key:5,value:d[a.key],"onUpdate:value":o=>d[a.key]=o,placeholder:`请输入${a.name}`,readonly:(r(l)?.id||i.check)&&a.readonly,disabled:!u[a.key]||(r(l)?.id||i.check)&&a.readonly},null,8,["value","onUpdate:value","placeholder","readonly","disabled"])),[[C,!i.check||!a.readonly]])]),_:2},1032,["required"])):b("",!0)],64))),128))]),_:1},8,["model"]),e[5]||(e[5]=h("hr",null,null,-1))]),_:1},8,["width","open","confirm-loading"])}}});export{qe as default};
