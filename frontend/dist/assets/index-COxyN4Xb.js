import{d as A,cT as L,ar as O,M as Q,r as o,w as G,i as H,a as z,o as y,g as d,b as t,Q as i,R as p,Z as k,k as R,e as J,bZ as $,F as K,U as W,t as f,S as X,cE as Y,cF as ll,cD as tl,l as w,b_ as B}from"./index-B79ij98t.js";import el from"./searcher-CxKGdWE8.js";import al from"./pager-DN_q0tsg.js";import{_ as ol}from"./log.vue_vue_type_script_setup_true_lang-wyXMg8bt.js";import{_ as sl}from"./logs.vue_vue_type_script_setup_true_lang-BjW2ZvKP.js";import{S as nl}from"./index-DBEqDIjy.js";import{_ as rl}from"./index-pYqC4PNK.js";import"./ajax-select.vue_vue_type_script_setup_true_lang-CKB63RLD.js";import"./index-84Fh6Zvb.js";import"./Trigger-bEby5AqF.js";import"./Overflow-BbIXCKr5.js";import"./List-BbMAA7pi.js";import"./isMobile--2fOlCHx.js";import"./useMemo-6CbExqSB.js";import"./useMergedState-ChKKoiD0.js";import"./move-dl2J5Yne.js";import"./slide-QRbVbzTY.js";import"./index-lGj6XUl7.js";import"./Col-Cu0BhNlX.js";import"./responsiveObserve-B7Xn1p3Q.js";import"./useFlexGapSupport-CrfIlOEx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LeftOutlined-Bl5FQDVR.js";import"./RightOutlined-DsQ0MVV1.js";import"./firstNotUndefined-CLFzEa0p.js";import"./td-Cke8TQJR.js";import"./strlib-BEzNp4-y.js";import"./log-diffs.vue_vue_type_script_setup_true_lang-B0tDXuHL.js";const ul={class:"portlet"},il={class:"portlet-head"},pl=["disabled"],dl={class:"portlet-body"},vl={class:"table table-hover"},ml={style:{width:"10px"}},cl=["value"],fl=["onClick"],gl={style:{"font-size":"1.02em"}},Ol=A({__name:"index",props:{rules:{},log_rules:{},arg:{},page_size:{}},setup(S){const C=S,V=L(),F=O(),I=Q(null),M=o({}),n=o(!0),s=o(!1),v=o([]),g=o(C.arg??{}),r=o({curr:1,size:C.page_size??10}),_=o(!1),U=o(""),u=o([]),x=o([]),b=o(!1),N=()=>{u.value=b.value?v.value.map(a=>a.id):[]};G(u,a=>{b.value=a.length>0&&a.length===v.value.length});const m=async a=>{n.value=!0,a&&(r.value.curr=1);try{const l={arg:g.value,page:r.value},c=await w.curl("fetch",l);c&&(v.value=c.data,r.value=c.page)}catch(l){console.error(l)}finally{T(),n.value=!1}},T=()=>{F.replace({path:V.path,query:w.mapToUriParams(g.value)})},E=a=>{console.log(a,"IDS"),_.value=!0,U.value=a},Z=async()=>{if(u.value.length==0){B.warn("请至少勾选一条数据");return}n.value=!0;const a=await w.curl("confirm",{ids:u.value});a.code?h(u.value):(s.value=!0,n.value=!1,x.value=a.data.allids,v.value=a.data.data)},h=async a=>{if(n.value=!0,!await B.confirm("确认操作？","")){n.value=!1;return}await w.ajax("rollback",{ids:a}),D()},D=()=>{s.value=!1,x.value=[],u.value=[],m()};return H(m),(a,l)=>{const c=nl,j=rl,q=X;return y(),z("div",ul,[d(sl,{open:_.value,"onUpdate:open":l[0]||(l[0]=e=>_.value=e),lids:U.value,log_rules:S.log_rules},null,8,["open","lids","log_rules"]),t("div",il,[i(t("button",{onClick:Z,disabled:n.value,class:"btn btn-primary"},[...l[8]||(l[8]=[t("i",{class:"fa fa-undo"},null,-1),k(" 回滚操作 ",-1)])],8,pl),[[p,!s.value]]),d(c,{style:{"margin-bottom":"10px"}},{default:R(()=>[i(t("button",{onClick:l[1]||(l[1]=e=>h(x.value)),class:"btn btn-warning"},[...l[9]||(l[9]=[t("i",{class:"fa fa-undo"},null,-1),k(" 确认回滚",-1)])],512),[[p,s.value]]),i(t("button",{onClick:D,class:"btn btn-success"},[...l[10]||(l[10]=[t("i",{class:"fa fa-arrow-left"},null,-1),k(" 取消操作",-1)])],512),[[p,s.value]])]),_:1}),i(d(j,{type:"warning",message:"由于操作之间的存在依赖关系，您必须同时回滚下面的全部操作"},null,512),[[p,s.value]])]),t("div",dl,[i(d(el,{arg:g.value,"onUpdate:arg":l[2]||(l[2]=e=>g.value=e),rules:C.rules??[],onSearch:m,onClear:l[3]||(l[3]=e=>m(!0))},null,8,["arg","rules"]),[[p,!s.value]]),d(q,{spinning:n.value},{default:R(()=>[t("table",vl,[t("thead",null,[t("tr",null,[t("th",ml,[i(t("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=e=>b.value=e),onChange:N},null,544),[[p,!s.value],[$,b.value]])]),l[11]||(l[11]=t("th",null,"ID",-1)),l[12]||(l[12]=t("th",null,"用户",-1)),l[13]||(l[13]=t("th",null,"路由",-1)),l[14]||(l[14]=t("th",null,"详情",-1)),l[15]||(l[15]=t("th",{style:{"padding-left":"110px"}},"改动示例",-1)),l[16]||(l[16]=t("th",null,"操作时间",-1))])]),t("tbody",null,[(y(!0),z(K,null,W(v.value,e=>(y(),z("tr",{key:e.id},[t("td",null,[i(t("input",{type:"checkbox","onUpdate:modelValue":l[5]||(l[5]=P=>u.value=P),value:e.id},null,8,cl),[[p,!s.value],[$,u.value]])]),t("td",null,f(e.id),1),t("td",null,f(e.user),1),t("td",null,f(e.path),1),t("td",null,[t("label",{class:"badge badge-info",style:{cursor:"pointer"},onClick:P=>E(e.lids)},[l[17]||(l[17]=t("i",{class:"fa fa-search"},null,-1)),l[18]||(l[18]=k()),t("b",gl,f(e.lids.split(",").length),1)],8,fl)]),t("td",null,[d(ol,{id:e.lids.split(",")[0]},null,8,["id"])]),t("td",null,f(e.created),1)]))),128))])])]),_:1},8,["spinning"]),i(d(al,{loading:n.value,total:r.value.total,curr:r.value.curr,"onUpdate:curr":l[6]||(l[6]=e=>r.value.curr=e),size:r.value.size,"onUpdate:size":l[7]||(l[7]=e=>r.value.size=e),onPageChange:m},null,8,["loading","total","curr","size"]),[[p,!s.value]]),(y(),J(tl(I.value),Y(ll(M.value)),null,16))])])}}});export{Ol as default};
