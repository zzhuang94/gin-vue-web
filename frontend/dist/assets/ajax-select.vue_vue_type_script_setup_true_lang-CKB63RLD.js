import{d as x,r as i,w as y,i as D,e as b,o as v,m as B,n as O,bh as z,k as f,g as V,S as I,a as N,U,F as j,l as p,Z as E,t as L}from"./index-B79ij98t.js";import{S as M,a as T}from"./index-84Fh6Zvb.js";const A=x({__name:"ajax-select",props:{value:{default:""},placeholder:{default:"请选择"},disabled:{type:Boolean,default:!1},class:{default:""},style:{},translate:{},url:{default:""}},emits:["update:value","change"],setup(n,{emit:w}){const l=n,h=w,o=i(l.value??""),u=i([]),c=i(!1),d=i(0);y(()=>l.value,a=>{o.value=a??""}),y(o,a=>{h("update:value",a),h("change",a)});const g=a=>{m(a)},S=a=>{a&&!u.value.length&&m("")},m=async a=>{c.value=!0,d.value+=1;const e=d.value;try{const t=await C(a);if(e!==d.value)return;u.value=t}catch(t){console.error("获取数据失败:",t)}finally{c.value=!1}};async function _(){if(!l.value)return[];const a=[],e=await p.curl("/base/trans/init?val="+l.value,l.translate);return e.code==1?a.push({value:e.data.key,label:e.data.val}):l.translate?.custom&&a.push({value:l.value,label:l.value}),a}async function k(a){let e={};return l.url!=""?e=await p.curl(l.url,{term:a}):e=await p.curl("/base/trans/load?term="+a,l.translate),e.data?e.data:[]}async function C(a){let t=(await k(a)).map(r=>({value:r.key,label:r.val}));return!(l.translate?.custom??0)||a==""||t.length>0&&t[0]?.label==a||t.unshift({value:a,label:a}),t}return D(async()=>{u.value=await _()}),(a,e)=>{const t=I,r=T,F=M;return v(),b(F,{value:o.value,"onUpdate:value":e[0]||(e[0]=s=>o.value=s),placeholder:n.placeholder,disabled:n.disabled,class:O(n.class),style:B(n.style),"show-search":"","allow-clear":"",filterOption:!1,notFoundContent:c.value?void 0:"无匹配结果",onSearch:g,onDropdownVisibleChange:S},z({default:f(()=>[(v(!0),N(j,null,U(u.value,s=>(v(),b(r,{key:s.value,value:s.value},{default:f(()=>[E(L(s.label),1)]),_:2},1032,["value"]))),128))]),_:2},[c.value?{name:"notFoundContent",fn:f(()=>[V(t,{size:"small"})]),key:"0"}:void 0]),1032,["value","placeholder","disabled","class","style","notFoundContent"])}}});export{A as _};
